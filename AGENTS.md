# Repository Guidelines

## Project Structure & Module Organization
- `src/` contains the TypeScript source for `ScrollAwareNav`: `index.ts` (core behavior), `types.ts` (public interfaces), `test-setup.ts` (test configuration).
- `src/__tests__/` contains comprehensive test suites: `ScrollAwareNav.test.ts` (unit tests), `scroll-behavior.test.ts` (behavior tests).
- `dist/` holds the compiled ES and UMD bundles plus generated TypeScript declarations; regenerate via build, do not edit.
- `index.html` provides local development demo, `docs.html` is optimized for GitHub Pages deployment.
- `vitest.config.ts`, `vite.config.ts`, `tsconfig.json` handle build and test configuration; keep changes documented.
- `.github/workflows/` contains CI/CD pipelines for testing (`ci.yml`) and GitHub Pages deployment (`deploy-pages.yml`).

## Build, Test, and Development Commands
- `bun install` (or `npm install`) to sync dependencies.
- `bun run dev` launches the Vite dev server with hot reload for the demo page.
- `bun run build` generates production assets in `dist/` with TypeScript declarations; required before publishing.
- `bun run preview` serves the built bundle for smoke testing.
- `bun run lint` runs ESLint over `src/`.
- `bun run format` applies Prettier to TypeScript and CSS files.
- `bun run test` runs tests in watch mode with Vitest.
- `bun run test:run` executes all tests once.
- `bun run test:ui` opens interactive test UI.
- `bun run test:coverage` generates test coverage reports.

## Coding Style & Naming Conventions
- Rely on Prettier and ESLint outputs; avoid manual spacing tweaks and let the formatter decide indentation.
- Use PascalCase for classes (`ScrollAwareNav`), camelCase for functions and variables, and SCSS-style BEM modifiers for CSS classes (`scroll-nav--hidden`).
- Keep comments concise;

## Testing Guidelines
- **Comprehensive test suite** with 25+ tests covering all functionality using Vitest and jsdom.
- Tests are located in `src/__tests__/` and named `*.test.ts`.
- Test coverage includes: constructor/initialization, browser support, CSS class management, lifecycle methods, scroll behavior, RAF optimization.
- **Mocking strategy**: Use `Object.defineProperty()` for DOM properties like `offsetHeight`, `pageYOffset`; mock RAF/timers with `vi.useFakeTimers()`.
- All new features must include corresponding tests; aim for >90% coverage.
- CI/CD automatically runs tests on Ubuntu, Windows, and macOS before deployment.

## Release & Publishing Guidelines
- **Automated release scripts**: Use `bun run release:prerelease` for dependency updates, `bun run release:patch|minor|major` for feature releases.
- Each release script automatically: bumps version, builds assets, publishes to NPM, creates git tags, and pushes to GitHub.
- **NPM Publishing**: Package is published as `scroll-aware-nav` with beta releases tagged as `@beta`.
- **GitHub Pages**: Demo site automatically deploys from `docs.html` to `https://jmartsch.github.io/scroll-aware-nav/`.
- Package exports ES modules (`dist/scroll-aware-nav.es.js`), UMD (`dist/scroll-aware-nav.umd.js`), and TypeScript declarations (`dist/index.d.ts`).

## Commit & Pull Request Guidelines
- Follow Conventional Commits style (`feat:`, `fix:`, `chore:`); version tags are auto-generated by release scripts.
- **Required checks**: All PRs must pass linting, testing, and building on CI before merge.
- Never commit `dist/` files manually; they're auto-generated by build process.
- PRs should describe behavior changes, include test coverage, and reference issues when applicable.
- CI/CD pipeline runs tests on multiple OS platforms and deploys demo site automatically.
